import{_ as t,c as r,k as a,b as n,p as s,q as l,d as p,o as d}from"./app-D29acTA2.js";const o={};function c(h,e){const i=p("PageLink");return d(),r("div",null,[e[0]||(e[0]=a(`<p>本文章皆在带你快速了解 TrMenu 3.0 以及升级步骤</p><h2 id="更新内容" tabindex="-1"><a class="header-anchor" href="#更新内容"><span>更新内容</span></a></h2><h3 id="底层" tabindex="-1"><a class="header-anchor" href="#底层"><span>底层</span></a></h3><ul><li>配置文件 &amp; 语言文件 格式全部重新设计</li><li>90% 代码完全重写, 瞄准极致性能体验</li><li>发包虚拟容器结构完全重制，更快 &amp; 更灵活</li></ul><h4 id="功能" tabindex="-1"><a class="header-anchor" href="#功能"><span>功能</span></a></h4><ul><li>新增 <code>Free-Slot</code> 项，解除目标槽位的物品锁定 （不稳定）</li></ul><h4 id="材质" tabindex="-1"><a class="header-anchor" href="#材质"><span>材质</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>head:%player_name% head:BlackSky</span></span>
<span class="line"><span>head:eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNDRmNDUyZDk5OGVhYmFjNDY0MmM2YjBmZTVhOGY0ZTJlNjczZWRjYWUyYTZkZmQ5ZTZhMmU4NmU3ODZlZGFjMCJ9fX0=</span></span>
<span class="line"><span>head:44f452d998eabac4642c6b0fe5a8f4e2e673edcae2a6dfd9e6a2e86e786edac0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>repo:myCustomItem</span></span>
<span class="line"><span>repo:%custom_variable_whichreturnstheid%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>source:HDB:random</span></span>
<span class="line"><span>source:ORAXEN:itemId</span></span>
<span class="line"><span></span></span>
<span class="line"><span>{json Content}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>特殊物品不再需要 { } 、&lt;&gt; 等</li><li>HeadDatabase / Oraxen / <strong>ItemsAdder</strong>(新) ****等物品挂钩需要以 ItemSource 格式</li><li>SkinsRestorer 的挂钩和自定义材质头颅一律集合到玩家头颅中，将自动检测处理</li></ul><h4 id="条件" tabindex="-1"><a class="header-anchor" href="#条件"><span>条件</span></a></h4><p>条件检测是本次更新最大的改动部分</p><p>现在条件弃用了 TrMenu 2 所提供的 “智能表达式”，仅支持 <strong>Kether</strong> 和 <strong>JavaScript</strong> 两种语句. 且默认使用 Kether 语句</p><ul><li><strong>Kether</strong><ul><li>Kether 官方文档会提供使用说明</li></ul></li><li><strong>JavaScript</strong><ul><li>需要 js 前缀，例如 <code>condition: &#39;js: player.getHealth() &gt; 20.0&#39;</code></li><li>全部缓存，不支持动态编译变量，使用变量需要套函数</li><li>默认提供<strong>对象</strong><ul><li><code>player</code></li><li><code>bukkitServer</code></li><li><code>utils</code></li></ul></li><li>默认提供<strong>函数</strong><ul><li><code>vars(&quot;STRING&quot;)</code> 编译变量，返回 String</li><li><code>varInt(&quot;STRING&quot;)</code> 编译变量，返回整型</li></ul></li></ul></li><li><strong>JEXL</strong></li><li><ul><li>需要 jexl 前缀,例如 <code>condition: &#39;jexl: player.getHealth() &gt; 20.0&#39;</code>(有没有感觉和JS差不多?)</li><li>默认提供<strong>对象</strong><ul><li><code>player</code></li><li><code>bukkitServer</code></li><li><code>utils</code></li></ul></li></ul></li></ul><blockquote><p>弃用 v2 写法原因:</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1. 臃肿不灵活，不完善引发的错误多</span></span>
<span class="line"><span>2. 没有规范缓存、变量处理</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h4 id="函数" tabindex="-1"><a class="header-anchor" href="#函数"><span>函数</span></a></h4>`,15)),n(i,s(l({path:"../usage/functions.md"})),null,16),e[1]||(e[1]=a('<h4 id="动作" tabindex="-1"><a class="header-anchor" href="#动作"><span>动作</span></a></h4><ul><li><strong>ActionBound</strong> 弃用 v1 遗留的 _||_ 写法，现阶段统一为 <code>&amp;&amp;&amp;</code></li><li><strong>Title</strong> 动作统一规范格式为 <ul><li><code>title: [标题] [副标题] [渐入时间] [停留] [渐出时间]</code></li><li>包含空格的标题文本应用 · 括起</li></ul></li><li><strong>Refresh</strong> 动作现在可以指定图标槽位来刷新单个图标</li><li><strong>ActionOption</strong> 动作参数现在推荐使用 <code>{[TYPE]=[VALUE]}</code> 的格式定义</li><li><strong>InputCatcher</strong> 捕获器现在规范的参数包括 <code>type</code>, <code>start</code>, <code>cancel</code>, <code>end</code>. 特殊参数有 <code>display</code>, <code>itemLeft</code>, <code>itemRight</code>, <code>content</code> &amp; 新增 BOOK 类型的捕获器</li></ul><h4 id="数据" tabindex="-1"><a class="header-anchor" href="#数据"><span>数据</span></a></h4><ul><li>Meta &amp; Data 功能模块重写，新增 GlobalData 用以设置全局变量</li><li>可通过 函数 功能调用</li></ul><h4 id="命令" tabindex="-1"><a class="header-anchor" href="#命令"><span>命令</span></a></h4><ul><li>物品仓库和物品转换合并为一个命令</li><li>音效预览功能基于 ReceptacleAPI 重写</li><li>性能损耗统计功能重写</li><li>菜单列表格式化</li><li>调试功能重写 Mirror &amp; Dump 功能集成到 Debug 下</li></ul>',6)),n(i,s(l({path:"../usage/command.md"})),null,16),e[2]||(e[2]=a(`<h4 id="api" tabindex="-1"><a class="header-anchor" href="#api"><span>API</span></a></h4><ul><li>提供 <code>ReceptacleAPI</code> 创建自定义虚拟容器，使用实例可参照 <code>me.arasple.mc.trmenu.module.internal.command.impl.CommandSounds</code></li></ul><h2 id="开始" tabindex="-1"><a class="header-anchor" href="#开始"><span>开始</span></a></h2><p>由于 v3.0-pre9(包括 v2.0) 之前的<strong>配置</strong> &amp; <strong>语言</strong>结构不兼容，菜单部分兼容</p><p>因此为了更好地完成升级，请先将旧的 TrMenu 文件夹重命名备用，</p><p>然后替换插件后生成新的 TrMenu 文件夹</p><h3 id="对于-v3-0-pre9-或更早的-v3-0-版本-trmenu-的相关说明" tabindex="-1"><a class="header-anchor" href="#对于-v3-0-pre9-或更早的-v3-0-版本-trmenu-的相关说明"><span>对于 v3.0-pre9 或更早的 v3.0 版本 TrMenu 的相关说明</span></a></h3><blockquote><p>尽管 TabooLib-pre29 及之后的版本已具备自动迁移, 但仍然建议您根据以下说明进行迁移, 以免发生迁移失败.</p></blockquote><p>在 TabooLib 6.0.0 发布 preview 版后, 已适配 1.17+ 服务端, 并会继续保持未来的新 Minecraft 版本的适配.</p><p>但其框架大改, 可能导致 TrMenu 部分特性与 TabooLib 5.x 时期有所不同, 例如 Kether 的一些语法.</p><p>建议删除先前的所有语言文件.</p><p>若您曾经更改过语言文件, 建议您备份 lang 文件夹, 对照最新的语言文件格式手动进行迁移.</p><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h2><p>根据本 Wiki 快速了解配置结构 &amp; 根据需要配置</p><h3 id="datasource-yml-对于-1-8-服务端" tabindex="-1"><a class="header-anchor" href="#datasource-yml-对于-1-8-服务端"><span>datasource.yml (对于 1.8 服务端)</span></a></h3><p>因 1.8 服务端 JDBC 驱动过旧, 因此需要对该配置文件做一些修改. 但该配置文件并没有出现在先前的 TrMenu(pre9 及更早) 版本中, 因此需要启动一次服务端使其生成.</p><p>若无故障, 您会看到以下错误信息:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[xx:xx:xx] [Server thread/INFO]: [TrMenu] Enabling TrMenu vX.X.X</span></span>
<span class="line"><span>[xx:xx:xx] [Server thread/WARN]: SLF4J: No SLF4J providers were found.</span></span>
<span class="line"><span>[xx:xx:xx] [Server thread/WARN]: SLF4J: Defaulting to no-operation (NOP) logger implementation</span></span>
<span class="line"><span>[xx:xx:xx] [Server thread/WARN]: SLF4J: See http://www.slf4j.org/codes.html#noProviders for further details.</span></span>
<span class="line"><span>[xx:xx:xx] [Server thread/ERROR]: Error occurred while enabling TrMenu (Is it up to date?)</span></span>
<span class="line"><span>java.lang.AbstractMethodError: org.sqlite.Conn.isValid(I)Z</span></span>
<span class="line"><span>	at com.zaxxer.hikari_4_0_3.pool.PoolBase.checkValidationSupport(PoolBase.java:464) ~[?:?]</span></span>
<span class="line"><span>	at com.zaxxer.hikari_4_0_3.pool.PoolBase.checkDriverSupport(PoolBase.java:447) ~[?:?]</span></span>
<span class="line"><span>	at com.zaxxer.hikari_4_0_3.pool.PoolBase.setupConnection(PoolBase.java:416) ~[?:?]</span></span>
<span class="line"><span>	at com.zaxxer.hikari_4_0_3.pool.PoolBase.newConnection(PoolBase.java:369) ~[?:?]</span></span>
<span class="line"><span>	at com.zaxxer.hikari_4_0_3.pool.PoolBase.newPoolEntry(PoolBase.java:206) ~[?:?]</span></span>
<span class="line"><span>	at com.zaxxer.hikari_4_0_3.pool.HikariPool.createPoolEntry(HikariPool.java:476) ~[?:?]</span></span>
<span class="line"><span>	at com.zaxxer.hikari_4_0_3.pool.HikariPool.checkFailFast(HikariPool.java:561) ~[?:?]</span></span>
<span class="line"><span>...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时, 配置文件 <code>plugins/TrMenu/datasource.yml</code> 将会出现.</p><p>找到该配置文件节点 <code>DefaultSettings.ConnectionTestQuery</code>, 默认值为 <code>~</code>, 只需要将它更改为 <code>SELECT 1</code>. 如下:</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # If your driver supports JDBC4 we strongly recommend not setting this property.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # This is for &quot;legacy&quot; drivers that do not support the JDBC4 Connection.isValid() API.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # This is the query that will be executed just before a connection is given to you from the pool to validate that the connection to the database is still alive.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # Again, try running the pool without this property, HikariCP will log an error if your driver is not JDBC4 compliant to let you know. Default: ~</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  ConnectionTestQuery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SELECT 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="菜单" tabindex="-1"><a class="header-anchor" href="#菜单"><span>菜单</span></a></h2><p>不兼容的点</p><ul><li>内置函数 &amp; 条件 &amp; 脚本</li><li>部分挂钩材质写法</li><li>(v1.x ) TITLE 动作写法</li><li>(v1.x) 动作选项绑定写法 <code>_||_</code></li></ul><p>解决方案</p><ul><li>确保完整阅读新版文档</li><li>按新格式重写条件（对于 JavaScript 需要处理字符串相关表达式）</li></ul><h2 id="q-a" tabindex="-1"><a class="header-anchor" href="#q-a"><span>Q &amp; A</span></a></h2><h4 id="为什么不提供一键迁移" tabindex="-1"><a class="header-anchor" href="#为什么不提供一键迁移"><span>为什么不提供一键迁移</span></a></h4><p>本次更新摒弃了 v2 的大部分臃肿设计 &amp; 重写了几乎所有模块</p><p>尤其涉及到脚本、条件方面的，迁移功能实属不容易做</p><p>如果你只使用了一些简单的条件或 JavaScript 形式的，相对来说升级要容易些</p><p>例如应用替换功能 <code>hasPerm.</code> -&gt; <code>perm *</code></p><h4 id="有必要升级吗" tabindex="-1"><a class="header-anchor" href="#有必要升级吗"><span>有必要升级吗</span></a></h4><p>新服或菜单需求量少（条件表达式少）的推荐尽快升级</p><p>对于正在运行的大型服务器，且或菜单量大的，建议在单独测试各个菜单后考虑升级</p><p>旧版本已停止维护和支持，不再处理遗留问题</p>`,36))])}const m=t(o,[["render",c],["__file","v3-guide.html.vue"]]),v=JSON.parse('{"path":"/plugins/plugins/trmenu/appendix/v3-guide.html","title":"升级向导","lang":"zh-CN","frontmatter":{"title":"升级向导","description":"本文章皆在带你快速了解 TrMenu 3.0 以及升级步骤 更新内容 底层 配置文件 & 语言文件 格式全部重新设计 90% 代码完全重写, 瞄准极致性能体验 发包虚拟容器结构完全重制，更快 & 更灵活 功能 新增 Free-Slot 项，解除目标槽位的物品锁定 （不稳定） 材质 特殊物品不再需要 { } 、<> 等 HeadDatabase / Or...","head":[["meta",{"property":"og:url","content":"https://bukkit.wiki/plugins/plugins/trmenu/appendix/v3-guide.html"}],["meta",{"property":"og:site_name","content":"BukkitWiki"}],["meta",{"property":"og:title","content":"升级向导"}],["meta",{"property":"og:description","content":"本文章皆在带你快速了解 TrMenu 3.0 以及升级步骤 更新内容 底层 配置文件 & 语言文件 格式全部重新设计 90% 代码完全重写, 瞄准极致性能体验 发包虚拟容器结构完全重制，更快 & 更灵活 功能 新增 Free-Slot 项，解除目标槽位的物品锁定 （不稳定） 材质 特殊物品不再需要 { } 、<> 等 HeadDatabase / Or..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-29T08:09:08.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-29T08:09:08.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"升级向导\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-29T08:09:08.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"更新内容","slug":"更新内容","link":"#更新内容","children":[{"level":3,"title":"底层","slug":"底层","link":"#底层","children":[]}]},{"level":2,"title":"开始","slug":"开始","link":"#开始","children":[{"level":3,"title":"对于 v3.0-pre9 或更早的 v3.0 版本 TrMenu 的相关说明","slug":"对于-v3-0-pre9-或更早的-v3-0-版本-trmenu-的相关说明","link":"#对于-v3-0-pre9-或更早的-v3-0-版本-trmenu-的相关说明","children":[]}]},{"level":2,"title":"配置","slug":"配置","link":"#配置","children":[{"level":3,"title":"datasource.yml (对于 1.8 服务端)","slug":"datasource-yml-对于-1-8-服务端","link":"#datasource-yml-对于-1-8-服务端","children":[]}]},{"level":2,"title":"菜单","slug":"菜单","link":"#菜单","children":[]},{"level":2,"title":"Q & A","slug":"q-a","link":"#q-a","children":[]}],"git":{"createdTime":1730189348000,"updatedTime":1730189348000,"contributors":[{"name":"大阔","email":"1520622465@qq.com","commits":1}]},"readingTime":{"minutes":4.86,"words":1458},"filePathRelative":"plugins/plugins/trmenu/appendix/v3-guide.md","localizedDate":"2024年10月29日","excerpt":"<p>本文章皆在带你快速了解 TrMenu 3.0 以及升级步骤</p>\\n<h2>更新内容</h2>\\n<h3>底层</h3>\\n<ul>\\n<li>配置文件 &amp; 语言文件 格式全部重新设计</li>\\n<li>90% 代码完全重写, 瞄准极致性能体验</li>\\n<li>发包虚拟容器结构完全重制，更快 &amp; 更灵活</li>\\n</ul>\\n<h4>功能</h4>\\n<ul>\\n<li>新增 <code>Free-Slot</code> 项，解除目标槽位的物品锁定 （不稳定）</li>\\n</ul>\\n<h4>材质</h4>\\n<div class=\\"language-text line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"text\\" data-title=\\"text\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>head:%player_name% head:BlackSky</span></span>\\n<span class=\\"line\\"><span>head:eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNDRmNDUyZDk5OGVhYmFjNDY0MmM2YjBmZTVhOGY0ZTJlNjczZWRjYWUyYTZkZmQ5ZTZhMmU4NmU3ODZlZGFjMCJ9fX0=</span></span>\\n<span class=\\"line\\"><span>head:44f452d998eabac4642c6b0fe5a8f4e2e673edcae2a6dfd9e6a2e86e786edac0</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>repo:myCustomItem</span></span>\\n<span class=\\"line\\"><span>repo:%custom_variable_whichreturnstheid%</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>source:HDB:random</span></span>\\n<span class=\\"line\\"><span>source:ORAXEN:itemId</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>{json Content}</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{m as comp,v as data};
